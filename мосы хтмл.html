<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ó–∞–ø–ß–∞—Å—Ç–∏ ‚Äî Mini App</title>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f0f2f5;
    --tg-bg: #ffffff;
    --surface: #ffffff;
    --surface2: #f7f8fa;
    --border: #e8eaed;
    --text: #1a1a2e;
    --text2: #6b7280;
    --accent: #2563eb;
    --accent-light: #eff6ff;
    --green: #16a34a;
    --green-light: #f0fdf4;
    --red: #dc2626;
    --tg-header: #2563eb;
    --radius: 12px;
    --shadow: 0 1px 3px rgba(0,0,0,0.08), 0 1px 2px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.12);
  }

  body {
    font-family: 'Manrope', sans-serif;
    background: var(--bg);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  /* Phone frame */
  .phone-frame {
    width: 375px;
    height: 780px;
    background: #1a1a2e;
    border-radius: 44px;
    padding: 12px;
    box-shadow: 0 30px 80px rgba(0,0,0,0.4), inset 0 0 0 1px rgba(255,255,255,0.1);
    position: relative;
    flex-shrink: 0;
  }

  .phone-notch {
    position: absolute;
    top: 12px;
    left: 50%;
    transform: translateX(-50%);
    width: 120px;
    height: 28px;
    background: #1a1a2e;
    border-radius: 0 0 16px 16px;
    z-index: 10;
  }

  .phone-screen {
    width: 100%;
    height: 100%;
    background: var(--tg-bg);
    border-radius: 34px;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Telegram header */
  .tg-header {
    background: var(--tg-header);
    padding: 44px 16px 12px;
    display: flex;
    align-items: center;
    gap: 12px;
    flex-shrink: 0;
  }

  .tg-back { color: white; font-size: 18px; cursor: pointer; opacity: 0.9; }

  .tg-bot-info { flex: 1; }
  .tg-bot-name { color: white; font-size: 15px; font-weight: 600; line-height: 1; }
  .tg-bot-status { color: rgba(255,255,255,0.7); font-size: 11px; margin-top: 2px; }

  .tg-avatar {
    width: 34px; height: 34px;
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px;
  }

  /* App content */
  .app-content {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    scrollbar-width: none;
  }
  .app-content::-webkit-scrollbar { display: none; }

  /* Pages */
  .page { display: none; }
  .page.active { display: block; animation: fadeIn 0.2s ease; }

  @keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

  /* Search bar */
  .search-bar {
    padding: 12px 14px;
    position: sticky;
    top: 0;
    background: white;
    z-index: 5;
    border-bottom: 1px solid var(--border);
  }

  .search-input {
    width: 100%;
    background: var(--surface2);
    border: none;
    border-radius: 10px;
    padding: 9px 12px 9px 36px;
    font-size: 14px;
    font-family: 'Manrope', sans-serif;
    color: var(--text);
    outline: none;
    position: relative;
  }

  .search-wrap { position: relative; }
  .search-icon {
    position: absolute;
    left: 11px; top: 50%;
    transform: translateY(-50%);
    color: var(--text2);
    font-size: 14px;
    pointer-events: none;
  }

  /* AI search states */
  .ai-thinking {
    display: none;
    padding: 10px 14px;
    font-size: 12px;
    color: var(--accent);
    font-weight: 500;
    align-items: center;
    gap: 8px;
  }
  .ai-thinking.visible { display: flex; }

  .spinner {
    width: 14px; height: 14px;
    border: 2px solid var(--accent-light);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.7s linear infinite;
    flex-shrink: 0;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  .ai-interpreted {
    display: none;
    margin: 0 14px 10px;
    background: var(--accent-light);
    border-radius: 10px;
    padding: 10px 12px;
    font-size: 12px;
    color: var(--accent);
    border-left: 3px solid var(--accent);
    line-height: 1.5;
  }
  .ai-interpreted.visible { display: block; }
  .ai-interpreted strong { font-weight: 700; }

  /* Manual request banner */
  .manual-request-banner {
    display: none;
    margin: 0 14px 12px;
    background: #fffbeb;
    border: 1.5px dashed #f59e0b;
    border-radius: 12px;
    padding: 12px;
    cursor: pointer;
    transition: background 0.15s;
  }
  .manual-request-banner:active { background: #fef3c7; }
  .manual-request-banner.visible { display: block; }
  .mrb-top { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; }
  .mrb-icon { font-size: 18px; }
  .mrb-title { font-size: 13px; font-weight: 700; color: #92400e; }
  .mrb-text { font-size: 12px; color: #b45309; line-height: 1.4; }

  /* Manual request modal */
  .modal-overlay {
    display: none;
    position: absolute;
    inset: 0;
    background: rgba(0,0,0,0.4);
    z-index: 20;
    align-items: flex-end;
    border-radius: 34px;
    overflow: hidden;
  }
  .modal-overlay.visible { display: flex; }

  .modal-sheet {
    background: white;
    width: 100%;
    border-radius: 20px 20px 0 0;
    padding: 20px 16px 28px;
    animation: slideUp 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }
  @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

  .modal-handle {
    width: 36px; height: 4px;
    background: var(--border);
    border-radius: 2px;
    margin: 0 auto 16px;
  }
  .modal-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .modal-sub { font-size: 12px; color: var(--text2); margin-bottom: 16px; line-height: 1.5; }

  .modal-textarea {
    width: 100%;
    background: var(--surface2);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 11px 13px;
    font-size: 14px;
    font-family: 'Manrope', sans-serif;
    color: var(--text);
    outline: none;
    resize: none;
    height: 90px;
    margin-bottom: 12px;
    transition: border-color 0.15s;
  }
  .modal-textarea:focus { border-color: var(--accent); }

  .modal-hints { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
  .hint-chip {
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 16px;
    padding: 4px 10px;
    font-size: 11px;
    color: var(--text2);
    cursor: pointer;
    font-family: 'Manrope', sans-serif;
    transition: all 0.15s;
  }
  .hint-chip:active { background: var(--accent-light); color: var(--accent); border-color: var(--accent); }

  .modal-send-btn {
    width: 100%;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 13px;
    font-size: 14px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    cursor: pointer;
  }
  .modal-cancel {
    width: 100%;
    background: none;
    border: none;
    color: var(--text2);
    font-size: 13px;
    font-family: 'Manrope', sans-serif;
    cursor: pointer;
    margin-top: 10px;
    padding: 4px;
  }

  /* Request sent confirmation */
  .request-sent {
    display: none;
    margin: 0 14px 12px;
    background: var(--green-light);
    border-radius: 12px;
    padding: 12px;
    align-items: center;
    gap: 10px;
    animation: fadeIn 0.2s ease;
  }
  .request-sent.visible { display: flex; }
  .request-sent-icon { font-size: 20px; }
  .request-sent-text { font-size: 12px; color: var(--green); font-weight: 600; line-height: 1.4; }

  /* Category chips */
  .category-strip {
    display: flex;
    gap: 8px;
    padding: 12px 14px;
    overflow-x: auto;
    scrollbar-width: none;
  }
  .category-strip::-webkit-scrollbar { display: none; }

  .chip {
    flex-shrink: 0;
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    border: 1.5px solid var(--border);
    color: var(--text2);
    background: white;
    transition: all 0.15s;
  }
  .chip.active {
    background: var(--accent);
    border-color: var(--accent);
    color: white;
  }

  /* Section label */
  .section-label {
    padding: 4px 14px 8px;
    font-size: 11px;
    font-weight: 700;
    color: var(--text2);
    letter-spacing: 0.06em;
    text-transform: uppercase;
  }

  /* Product cards */
  .product-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    padding: 0 14px 14px;
  }

  .product-card {
    background: white;
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    cursor: pointer;
    transition: transform 0.15s, box-shadow 0.15s;
    border: 1px solid var(--border);
  }
  .product-card:active { transform: scale(0.97); }

  .product-img {
    width: 100%;
    aspect-ratio: 1;
    background: var(--surface2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 36px;
  }

  .product-info { padding: 10px; }
  .product-name { font-size: 12px; font-weight: 600; color: var(--text); line-height: 1.3; margin-bottom: 2px; }
  .product-compat { font-size: 10px; color: var(--text2); margin-bottom: 6px; }

  .product-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .product-price { font-size: 14px; font-weight: 700; color: var(--text); }

  .add-btn {
    width: 26px; height: 26px;
    background: var(--accent);
    border: none;
    border-radius: 8px;
    color: white;
    font-size: 16px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: background 0.15s;
    font-weight: 300;
    line-height: 1;
  }
  .add-btn:active { background: #1d4ed8; }
  .add-btn.added { background: var(--green); }

  /* Cart bar */
  .cart-bar {
    position: sticky;
    bottom: 0;
    background: white;
    border-top: 1px solid var(--border);
    padding: 12px 14px;
    display: none;
  }
  .cart-bar.visible { display: block; }

  .cart-btn {
    width: 100%;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 14px;
    font-size: 14px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.15s;
  }
  .cart-btn:active { background: #1d4ed8; }
  .cart-btn-left { display: flex; align-items: center; gap: 8px; }
  .cart-count-badge {
    background: rgba(255,255,255,0.25);
    border-radius: 6px;
    padding: 2px 7px;
    font-size: 12px;
  }

  /* Cart page */
  .cart-header {
    padding: 16px 14px 8px;
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
  }

  .cart-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 14px;
    border-bottom: 1px solid var(--border);
    background: white;
    animation: fadeIn 0.2s ease;
  }

  .cart-item-emoji {
    width: 44px; height: 44px;
    background: var(--surface2);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }

  .cart-item-info { flex: 1; }
  .cart-item-name { font-size: 13px; font-weight: 600; color: var(--text); }
  .cart-item-compat { font-size: 11px; color: var(--text2); margin-top: 1px; }

  .cart-item-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
  .cart-item-price { font-size: 14px; font-weight: 700; color: var(--text); }

  .qty-control {
    display: flex; align-items: center; gap: 8px;
  }
  .qty-btn {
    width: 24px; height: 24px;
    border-radius: 6px;
    border: 1.5px solid var(--border);
    background: white;
    color: var(--text);
    font-size: 14px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-weight: 600;
  }
  .qty-btn.minus { color: var(--red); border-color: #fecaca; }
  .qty-num { font-size: 14px; font-weight: 600; min-width: 16px; text-align: center; }

  .cart-summary {
    margin: 12px 14px;
    background: var(--surface2);
    border-radius: var(--radius);
    padding: 14px;
  }

  .summary-row {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: var(--text2);
    margin-bottom: 8px;
  }
  .summary-row:last-child { margin-bottom: 0; }
  .summary-row.total {
    font-size: 15px;
    font-weight: 700;
    color: var(--text);
    border-top: 1px solid var(--border);
    padding-top: 8px;
    margin-top: 4px;
  }

  .checkout-btn {
    width: 100%;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: var(--radius);
    padding: 15px;
    font-size: 15px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    cursor: pointer;
    margin: 0 14px;
    width: calc(100% - 28px);
    display: block;
    transition: background 0.15s;
  }
  .checkout-btn:active { background: #1d4ed8; }

  /* Order form */
  .order-form { padding: 14px; }

  .form-title { font-size: 17px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .form-subtitle { font-size: 13px; color: var(--text2); margin-bottom: 20px; }

  .form-label { font-size: 12px; font-weight: 600; color: var(--text2); margin-bottom: 6px; display: block; letter-spacing: 0.04em; }

  .form-field {
    width: 100%;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 11px 13px;
    font-size: 14px;
    font-family: 'Manrope', sans-serif;
    color: var(--text);
    outline: none;
    margin-bottom: 14px;
    transition: border-color 0.15s;
    background: white;
  }
  .form-field:focus { border-color: var(--accent); }

  .radio-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 14px; }
  .radio-option {
    display: flex; align-items: center; gap: 10px;
    padding: 11px 13px;
    border: 1.5px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.15s;
  }
  .radio-option.selected { border-color: var(--accent); background: var(--accent-light); }
  .radio-dot {
    width: 18px; height: 18px;
    border-radius: 50%;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: all 0.15s;
  }
  .radio-option.selected .radio-dot { border-color: var(--accent); background: var(--accent); }
  .radio-option.selected .radio-dot::after {
    content: '';
    width: 6px; height: 6px;
    border-radius: 50%;
    background: white;
  }
  .radio-text { font-size: 13px; font-weight: 500; color: var(--text); }
  .radio-sub { font-size: 11px; color: var(--text2); }

  /* Success page */
  .success-page {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    text-align: center;
    height: 100%;
    min-height: 500px;
  }

  .success-icon {
    width: 72px; height: 72px;
    background: var(--green-light);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 32px;
    margin-bottom: 20px;
    animation: pop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  @keyframes pop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }

  .success-title { font-size: 20px; font-weight: 700; color: var(--text); margin-bottom: 8px; }
  .success-text { font-size: 14px; color: var(--text2); line-height: 1.6; margin-bottom: 24px; }

  .order-num {
    background: var(--surface2);
    border-radius: var(--radius);
    padding: 14px 20px;
    margin-bottom: 24px;
    width: 100%;
  }
  .order-num-label { font-size: 11px; color: var(--text2); font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; }
  .order-num-val { font-size: 22px; font-weight: 700; color: var(--accent); margin-top: 4px; }

  .back-home-btn {
    width: 100%;
    background: var(--accent-light);
    color: var(--accent);
    border: none;
    border-radius: var(--radius);
    padding: 13px;
    font-size: 14px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    cursor: pointer;
  }

  /* Info panel next to phone */
  .info-panel {
    max-width: 280px;
    padding: 0 0 0 32px;
  }

  .info-panel h2 {
    font-family: 'Manrope', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: #1a1a2e;
    margin-bottom: 8px;
  }

  .info-panel p {
    font-family: 'Manrope', sans-serif;
    font-size: 14px;
    color: #6b7280;
    line-height: 1.6;
    margin-bottom: 20px;
  }

  .step {
    display: flex;
    gap: 12px;
    margin-bottom: 16px;
    align-items: flex-start;
  }

  .step-num {
    width: 28px; height: 28px;
    background: #eff6ff;
    border-radius: 50%;
    color: #2563eb;
    font-size: 13px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }

  .step-text {
    font-family: 'Manrope', sans-serif;
    font-size: 13px;
    color: #374151;
    line-height: 1.5;
    padding-top: 4px;
  }

  .tag {
    display: inline-block;
    background: #f0fdf4;
    color: #16a34a;
    border-radius: 6px;
    padding: 3px 9px;
    font-size: 11px;
    font-weight: 700;
    font-family: 'Manrope', sans-serif;
    margin-bottom: 16px;
  }

  .wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0;
    min-height: 100vh;
    padding: 20px;
  }

  @media (max-width: 700px) {
    .info-panel { display: none; }
    .wrapper { padding: 10px; }
  }
</style>
</head>
<body>
<div class="wrapper">

  <!-- Info panel -->
  <div class="info-panel">
    <div class="tag">‚ú¶ –ü—Ä–æ—Ç–æ—Ç–∏–ø</div>
    <h2>Telegram Mini App –¥–ª—è –∑–∞–ø—á–∞—Å—Ç–µ–π</h2>
    <p>–í–æ—Ç –∫–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞. –õ–∏—Å—Ç–∞–π –≤–Ω–∏–∑, –¥–æ–±–∞–≤–ª—è–π —Ç–æ–≤–∞—Ä—ã –≤ –∫–æ—Ä–∑–∏–Ω—É –∏ –æ—Ñ–æ—Ä–º–ª—è–π –∑–∞–∫–∞–∑ ‚Äî –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç!</p>

    <div class="step">
      <div class="step-num">1</div>
      <div class="step-text">–ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –±–æ—Ç—É –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥ –∑–∞–ø—á–∞—Å—Ç–µ–π</div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-text">–î–æ–±–∞–≤–ª—è–µ—Ç –Ω—É–∂–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-text">–û—Ñ–æ—Ä–º–ª—è–µ—Ç –∑–∞–∫–∞–∑ ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-text">–ì–æ—Ç–æ–≤–æ. –ë–µ–∑ –∑–≤–æ–Ω–∫–æ–≤ –∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏</div>
    </div>
  </div>

  <!-- Phone frame -->
  <div class="phone-frame">
    <div class="phone-notch"></div>
    <div class="phone-screen">

      <!-- Telegram header -->
      <div class="tg-header">
        <div class="tg-back" id="backBtn" onclick="goBack()">‚Äπ</div>
        <div class="tg-avatar">üì±</div>
        <div class="tg-bot-info">
          <div class="tg-bot-name">–ó–∞–ø—á–∞—Å—Ç–∏–ë–æ—Ç</div>
          <div class="tg-bot-status">–æ–Ω–ª–∞–π–Ω</div>
        </div>
      </div>

      <!-- App content -->
      <div class="app-content" id="appContent">

        <!-- CATALOG PAGE -->
        <div class="page active" id="page-catalog">
          <div class="search-bar">
            <div class="search-wrap">
              <span class="search-icon">üîç</span>
              <input class="search-input" id="searchInput" placeholder="–ü–æ–ø—Ä–æ–±—É–π: '–∑–∞–¥ —Å–∞–º—Å–∞', '–∞–∫–± 13'..." oninput="onSearch(this.value)">
            </div>
          </div>

          <div class="ai-thinking" id="aiThinking">
            <div class="spinner"></div>
            <span>AI —Ä–∞–∑–±–∏—Ä–∞–µ—Ç –∑–∞–ø—Ä–æ—Å...</span>
          </div>

          <div class="ai-interpreted" id="aiInterpreted"></div>

          <div class="request-sent" id="requestSent">
            <div class="request-sent-icon">‚úÖ</div>
            <div class="request-sent-text">–ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –º–µ–Ω–µ–¥–∂–µ—Ä—É. –û—Ç–≤–µ—Ç–∏–º –≤ —Ç–µ—á–µ–Ω–∏–µ 15 –º–∏–Ω—É—Ç.</div>
          </div>

          <div class="manual-request-banner" id="manualBanner" onclick="openManualModal()">
            <div class="mrb-top">
              <div class="mrb-icon">üí¨</div>
              <div class="mrb-title">–ù–µ –Ω–∞—à–ª–∏ –Ω—É–∂–Ω–æ–µ?</div>
            </div>
            <div class="mrb-text">–û–ø–∏—à–∏—Ç–µ –∑–∞–ø—á–∞—Å—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–±–µ—Ä—ë—Ç –∏ –æ—Ç–≤–µ—Ç–∏—Ç –±—ã—Å—Ç—Ä–æ.</div>
          </div>

          <div class="category-strip" id="categoryStrip">
            <div class="chip active" onclick="filterChip(this, 'all')">–í—Å–µ</div>
            <div class="chip" onclick="filterChip(this, 'screen')">–≠–∫—Ä–∞–Ω—ã</div>
            <div class="chip" onclick="filterChip(this, 'battery')">–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã</div>
            <div class="chip" onclick="filterChip(this, 'camera')">–ö–∞–º–µ—Ä—ã</div>
            <div class="chip" onclick="filterChip(this, 'case')">–ö–æ—Ä–ø—É—Å–∞</div>
          </div>

          <div class="section-label" id="sectionLabel">–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ</div>

          <div class="product-grid" id="productGrid"></div>

          <!-- Manual request modal -->
          <div class="modal-overlay" id="manualModal" onclick="closeModalIfOutside(event)">
            <div class="modal-sheet">
              <div class="modal-handle"></div>
              <div class="modal-title">–ó–∞–ø—Ä–æ—Å –º–µ–Ω–µ–¥–∂–µ—Ä—É</div>
              <div class="modal-sub">–û–ø–∏—à–∏—Ç–µ —á—Ç–æ –Ω—É–∂–Ω–æ –∫–∞–∫ —É–≥–æ–¥–Ω–æ ‚Äî –º–æ–¥–µ–ª—å, —Å–∏–º–ø—Ç–æ–º, –∫–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç–µ —Å–∞–º–∏. –ú—ã –ø–æ–π–º—ë–º.</div>
              <textarea class="modal-textarea" id="manualText" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω—É–∂–µ–Ω –∑–∞–¥ –Ω–∞ —Å–∞–º—Å–∞ –∞52, —Å–∏–Ω–∏–π, —Å—Ä–æ—á–Ω–æ..."></textarea>
              <div class="modal-hints">
                <div class="hint-chip" onclick="appendHint('–∑–∞–¥–Ω—è—è –∫—Ä—ã—à–∫–∞ ')">–∑–∞–¥–Ω—è—è –∫—Ä—ã—à–∫–∞</div>
                <div class="hint-chip" onclick="appendHint('–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä ')">–∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä</div>
                <div class="hint-chip" onclick="appendHint('–¥–∏—Å–ø–ª–µ–π ')">–¥–∏—Å–ø–ª–µ–π</div>
                <div class="hint-chip" onclick="appendHint('iPhone ')">iPhone</div>
                <div class="hint-chip" onclick="appendHint('Samsung ')">Samsung</div>
                <div class="hint-chip" onclick="appendHint('—Å—Ä–æ—á–Ω–æ ')">—Å—Ä–æ—á–Ω–æ</div>
              </div>
              <button class="modal-send-btn" onclick="sendManualRequest()">üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å</button>
              <button class="modal-cancel" onclick="closeManualModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
          </div>
        </div>

        <!-- CART PAGE -->
        <div class="page" id="page-cart">
          <div class="cart-header">–ö–æ—Ä–∑–∏–Ω–∞</div>
          <div id="cartItems"></div>
          <div class="cart-summary" id="cartSummary"></div>
          <button class="checkout-btn" onclick="showPage('form')" style="margin-top:12px">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ ‚Üí</button>
          <div style="height: 20px;"></div>
        </div>

        <!-- ORDER FORM PAGE -->
        <div class="page" id="page-form">
          <div class="order-form">
            <div class="form-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</div>
            <div class="form-subtitle">–ó–∞–ø–æ–ª–Ω–∏ –¥–∞–Ω–Ω—ã–µ ‚Äî –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è</div>

            <label class="form-label">–ò–º—è</label>
            <input class="form-field" placeholder="–ê–ª–µ–∫—Å–µ–π" value="">

            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input class="form-field" placeholder="+7 900 000 00 00" value="">

            <label class="form-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É</label>
            <input class="form-field" placeholder="–ù—É–∂–Ω–æ —Å—Ä–æ—á–Ω–æ, —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å iPhone 13 Pro...">

            <label class="form-label">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</label>
            <div class="radio-group">
              <div class="radio-option selected" onclick="selectRadio(this)">
                <div class="radio-dot"></div>
                <div>
                  <div class="radio-text">–°–∞–º–æ–≤—ã–≤–æ–∑</div>
                  <div class="radio-sub">–≥. –ê–ª–º–∞—Ç—ã, —É–ª. –ê–±–∞—è 10</div>
                </div>
              </div>
              <div class="radio-option" onclick="selectRadio(this)">
                <div class="radio-dot"></div>
                <div>
                  <div class="radio-text">–î–æ—Å—Ç–∞–≤–∫–∞ –∫—É—Ä—å–µ—Ä–æ–º</div>
                  <div class="radio-sub">–æ—Ç 500 ‚Ç∏, 1‚Äì2 –¥–Ω—è</div>
                </div>
              </div>
              <div class="radio-option" onclick="selectRadio(this)">
                <div class="radio-dot"></div>
                <div>
                  <div class="radio-text">–ü–æ—á—Ç–∞ / –°–î–≠–ö</div>
                  <div class="radio-sub">3‚Äì7 –¥–Ω–µ–π</div>
                </div>
              </div>
            </div>

            <button class="checkout-btn" style="margin: 0; width: 100%;" onclick="submitOrder()">‚úì –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
          </div>
        </div>

        <!-- SUCCESS PAGE -->
        <div class="page" id="page-success">
          <div class="success-page">
            <div class="success-icon">‚úì</div>
            <div class="success-title">–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!</div>
            <div class="success-text">–ú—ã –ø–æ–ª—É—á–∏–ª–∏ —Ç–≤–æ—é –∑–∞—è–≤–∫—É –∏ —Å–≤—è–∂–µ–º—Å—è –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</div>
            <div class="order-num">
              <div class="order-num-label">–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞</div>
              <div class="order-num-val" id="orderNum">#ZP-0000</div>
            </div>
            <button class="back-home-btn" onclick="resetAndGoHome()">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
          </div>
        </div>

      </div>

      <!-- Cart bar -->
      <div class="cart-bar" id="cartBar">
        <button class="cart-btn" onclick="showPage('cart')">
          <div class="cart-btn-left">
            üõí <span class="cart-count-badge" id="cartCountBadge">0</span> —Ç–æ–≤–∞—Ä–æ–≤
          </div>
          <span id="cartTotal">0 ‚Ç∏</span>
        </button>
      </div>

    </div>
  </div>

</div>

<script>
const products = [
  { id:1, emoji:'üì±', name:'–î–∏—Å–ø–ª–µ–π OLED', compat:'iPhone 13 Pro', price:18500, cat:'screen' },
  { id:2, emoji:'üîã', name:'–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä', compat:'Samsung S21', price:4200, cat:'battery' },
  { id:3, emoji:'üì∏', name:'–ö–∞–º–µ—Ä–∞ –æ—Å–Ω–æ–≤–Ω–∞—è', compat:'iPhone 12', price:9800, cat:'camera' },
  { id:4, emoji:'üì±', name:'–î–∏—Å–ø–ª–µ–π LCD', compat:'Xiaomi Redmi 10', price:5600, cat:'screen' },
  { id:5, emoji:'üîã', name:'–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä', compat:'iPhone 13', price:3800, cat:'battery' },
  { id:6, emoji:'üñºÔ∏è', name:'–ó–∞–¥–Ω—è—è –∫—Ä—ã—à–∫–∞', compat:'Samsung A52', price:2100, cat:'case' },
  { id:7, emoji:'üì∏', name:'–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞', compat:'Xiaomi Mi 11', price:3400, cat:'camera' },
  { id:8, emoji:'üñºÔ∏è', name:'–ö–æ—Ä–ø—É—Å (—Ä–∞–º–∫–∞)', compat:'iPhone 11', price:6700, cat:'case' },
];

let cart = {};
let currentFilter = 'all';
let searchTimeout = null;
let lastQuery = '';

// ‚îÄ‚îÄ AI SEARCH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

async function onSearch(query) {
  clearTimeout(searchTimeout);
  document.getElementById('aiInterpreted').classList.remove('visible');
  document.getElementById('manualBanner').classList.remove('visible');
  document.getElementById('requestSent').classList.remove('visible');

  if (!query.trim()) {
    document.getElementById('aiThinking').classList.remove('visible');
    document.getElementById('sectionLabel').textContent = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ';
    renderProducts(currentFilter);
    return;
  }

  lastQuery = query;

  // Short debounce
  searchTimeout = setTimeout(() => runAISearch(query), 600);
}

async function runAISearch(query) {
  if (query !== lastQuery) return;

  document.getElementById('aiThinking').classList.add('visible');

  try {
    const productList = products.map(p =>
      `ID:${p.id} | ${p.name} | —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ${p.compat} | –∫–∞—Ç–µ–≥–æ—Ä–∏—è: ${p.cat}`
    ).join('\n');

    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 400,
        system: `–¢—ã –ø–æ–º–æ—â–Ω–∏–∫ –≤ –º–∞–≥–∞–∑–∏–Ω–µ –∑–∞–ø—á–∞—Å—Ç–µ–π –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤. –ú–∞—Å—Ç–µ—Ä–∞ –ø–∏—à—É—Ç –∂–∞—Ä–≥–æ–Ω–Ω–æ: "–∑–∞–¥" = –∑–∞–¥–Ω—è—è –∫—Ä—ã—à–∫–∞, "–∞–∫–±" = –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä, "—ç–∫—Ä–∞–Ω"/"–¥–∏—Å–ø" = –¥–∏—Å–ø–ª–µ–π, "—Å–∞–º—Å–∞"/"—Å–∞–º—Å—É–Ω–≥" = Samsung, "—è–±–ª–æ–∫–æ"/"–∞–π—Ñ–æ–Ω" = iPhone, "–∫—Å—è–æ–º–∏"/"–∫—Å–∏–æ–º–∏"/"—Å—è–æ–º–∏" = Xiaomi. –ß–∏—Å–ª–∞ –±–µ–∑ –º–æ–¥–µ–ª–∏ ‚Äî —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä "13" = iPhone 13, "–∞52" = Samsung A52).

–ö–∞—Ç–∞–ª–æ–≥:
${productList}

–û—Ç–≤–µ—Ç—å –¢–û–õ–¨–ö–û JSON (–±–µ–∑ markdown):
{
  "interpreted": "—á—Ç–æ –ø–æ–Ω—è–ª –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º",
  "matchedIds": [–º–∞—Å—Å–∏–≤ ID –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤, –ø—É—Å—Ç–æ–π –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ],
  "noResults": true/false
}`,
        messages: [{ role: "user", content: query }]
      })
    });

    const data = await response.json();
    const text = data.content[0].text;
    const parsed = JSON.parse(text.replace(/```json|```/g, '').trim());

    document.getElementById('aiThinking').classList.remove('visible');

    if (parsed.interpreted) {
      const el = document.getElementById('aiInterpreted');
      el.innerHTML = `ü§ñ <strong>–ü–æ–Ω—è–ª:</strong> ${parsed.interpreted}`;
      el.classList.add('visible');
    }

    if (parsed.matchedIds && parsed.matchedIds.length > 0) {
      const matched = products.filter(p => parsed.matchedIds.includes(p.id));
      document.getElementById('sectionLabel').textContent = `–ù–∞–π–¥–µ–Ω–æ: ${matched.length}`;
      renderProductList(matched);
      // Show manual banner anyway ‚Äî maybe they want something else too
      setTimeout(() => document.getElementById('manualBanner').classList.add('visible'), 800);
    } else {
      document.getElementById('sectionLabel').textContent = '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
      renderProductList([]);
      document.getElementById('manualBanner').classList.add('visible');
    }

  } catch (e) {
    // Fallback to simple search if API fails
    document.getElementById('aiThinking').classList.remove('visible');
    const q = query.toLowerCase();
    const matched = products.filter(p =>
      p.name.toLowerCase().includes(q) ||
      p.compat.toLowerCase().includes(q) ||
      simpleAlias(q, p)
    );
    document.getElementById('sectionLabel').textContent = matched.length ? `–ù–∞–π–¥–µ–Ω–æ: ${matched.length}` : '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
    renderProductList(matched);
    if (!matched.length) document.getElementById('manualBanner').classList.add('visible');
  }
}

function simpleAlias(q, p) {
  const aliases = {
    '–∞–∫–±': 'battery', '–±–∞—Ç–∞—Ä–µ—è': 'battery', '–±–∞—Ç–∞—Ä': 'battery',
    '—ç–∫—Ä–∞–Ω': 'screen', '–¥–∏—Å–ø': 'screen', '–¥–∏—Å–ø–ª–µ–π': 'screen',
    '–∑–∞–¥': 'case', '–∫—Ä—ã—à–∫–∞': 'case', '–∫–æ—Ä–ø—É—Å': 'case',
    '–∫–∞–º–µ—Ä–∞': 'camera', '–∫–∞–º': 'camera',
    '—Å–∞–º—Å–∞': 'samsung', '—Å–∞–º—Å—É–Ω–≥': 'samsung',
    '—è–±–ª–æ–∫–æ': 'iphone', '–∞–π—Ñ–æ–Ω': 'iphone',
  };
  for (const [key, val] of Object.entries(aliases)) {
    if (q.includes(key)) {
      if (['battery','screen','case','camera'].includes(val) && p.cat === val) return true;
      if (['samsung','iphone'].includes(val) && p.compat.toLowerCase().includes(val)) return true;
    }
  }
  return false;
}

// ‚îÄ‚îÄ MANUAL REQUEST MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function openManualModal() {
  const modal = document.getElementById('manualModal');
  modal.classList.add('visible');
  const txt = document.getElementById('manualText');
  if (lastQuery) txt.value = lastQuery;
  setTimeout(() => txt.focus(), 100);
}

function closeManualModal() {
  document.getElementById('manualModal').classList.remove('visible');
}

function closeModalIfOutside(e) {
  if (e.target === document.getElementById('manualModal')) closeManualModal();
}

function appendHint(text) {
  const ta = document.getElementById('manualText');
  ta.value += text;
  ta.focus();
}

function sendManualRequest() {
  const text = document.getElementById('manualText').value.trim();
  if (!text) return;
  closeManualModal();
  document.getElementById('manualBanner').classList.remove('visible');
  document.getElementById('requestSent').classList.add('visible');
  document.getElementById('manualText').value = '';
  // In real app: send to Telegram bot API here
}

// ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function renderProducts(filter) {
  const filtered = filter === 'all' ? products : products.filter(p => p.cat === filter);
  renderProductList(filtered);
}

function renderProductList(list) {
  const grid = document.getElementById('productGrid');
  if (!list.length) {
    grid.innerHTML = `<div style="grid-column:1/-1;padding:24px 0;text-align:center;color:var(--text2);font-size:13px;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>`;
    return;
  }
  grid.innerHTML = list.map(p => `
    <div class="product-card" onclick="openProduct(${p.id})">
      <div class="product-img">${p.emoji}</div>
      <div class="product-info">
        <div class="product-name">${p.name}</div>
        <div class="product-compat">${p.compat}</div>
        <div class="product-footer">
          <div class="product-price">${p.price.toLocaleString('ru')} ‚Ç∏</div>
          <button class="add-btn ${cart[p.id] ? 'added' : ''}" onclick="addToCart(event, ${p.id})">
            ${cart[p.id] ? '‚úì' : '+'}
          </button>
        </div>
      </div>
    </div>
  `).join('');
}

function filterChip(el, cat) {
  document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  currentFilter = cat;
  document.getElementById('searchInput').value = '';
  document.getElementById('aiInterpreted').classList.remove('visible');
  document.getElementById('manualBanner').classList.remove('visible');
  document.getElementById('sectionLabel').textContent = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ';
  renderProducts(cat);
}

function addToCart(e, id) {
  e.stopPropagation();
  if (cart[id]) {
    cart[id].qty++;
  } else {
    const p = products.find(p => p.id === id);
    cart[id] = { ...p, qty: 1 };
  }
  updateCartUI();
  renderProductList(document.querySelectorAll('.product-card').length ? 
    products.filter(p => document.querySelector(`[onclick="openProduct(${p.id})"]`)) : products);
  // Re-render current view
  const q = document.getElementById('searchInput').value;
  if (!q) renderProducts(currentFilter);
}

function updateCartUI() {
  const items = Object.values(cart);
  const totalQty = items.reduce((s, i) => s + i.qty, 0);
  const totalPrice = items.reduce((s, i) => s + i.price * i.qty, 0);
  const bar = document.getElementById('cartBar');
  bar.classList.toggle('visible', totalQty > 0);
  document.getElementById('cartCountBadge').textContent = totalQty;
  document.getElementById('cartTotal').textContent = totalPrice.toLocaleString('ru') + ' ‚Ç∏';
}

function renderCart() {
  const items = Object.values(cart);
  const totalPrice = items.reduce((s, i) => s + i.price * i.qty, 0);
  const delivery = 500;
  document.getElementById('cartItems').innerHTML = items.map(item => `
    <div class="cart-item">
      <div class="cart-item-emoji">${item.emoji}</div>
      <div class="cart-item-info">
        <div class="cart-item-name">${item.name}</div>
        <div class="cart-item-compat">${item.compat}</div>
      </div>
      <div class="cart-item-right">
        <div class="cart-item-price">${(item.price * item.qty).toLocaleString('ru')} ‚Ç∏</div>
        <div class="qty-control">
          <button class="qty-btn minus" onclick="changeQty(${item.id}, -1)">‚àí</button>
          <span class="qty-num">${item.qty}</span>
          <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
        </div>
      </div>
    </div>
  `).join('');
  document.getElementById('cartSummary').innerHTML = `
    <div class="summary-row"><span>–¢–æ–≤–∞—Ä—ã (${items.length} –ø–æ–∑–∏—Ü–∏–∏)</span><span>${totalPrice.toLocaleString('ru')} ‚Ç∏</span></div>
    <div class="summary-row"><span>–î–æ—Å—Ç–∞–≤–∫–∞</span><span>${delivery.toLocaleString('ru')} ‚Ç∏</span></div>
    <div class="summary-row total"><span>–ò—Ç–æ–≥–æ</span><span>${(totalPrice + delivery).toLocaleString('ru')} ‚Ç∏</span></div>
  `;
}

function changeQty(id, delta) {
  if (!cart[id]) return;
  cart[id].qty += delta;
  if (cart[id].qty <= 0) delete cart[id];
  updateCartUI();
  renderCart();
  if (Object.keys(cart).length === 0) showPage('catalog');
}

let pageHistory = ['catalog'];

function showPage(name) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + name).classList.add('active');
  document.getElementById('appContent').scrollTop = 0;
  if (name === 'cart') renderCart();
  if (name !== 'catalog') {
    if (pageHistory[pageHistory.length - 1] !== name) pageHistory.push(name);
  }
  const bar = document.getElementById('cartBar');
  if (name === 'catalog') updateCartUI();
  else bar.classList.remove('visible');
}

function goBack() {
  if (pageHistory.length > 1) {
    pageHistory.pop();
    showPage(pageHistory[pageHistory.length - 1]);
  }
}

function selectRadio(el) {
  document.querySelectorAll('.radio-option').forEach(r => r.classList.remove('selected'));
  el.classList.add('selected');
}

function submitOrder() {
  const num = '#ZP-' + Math.floor(1000 + Math.random() * 9000);
  document.getElementById('orderNum').textContent = num;
  cart = {};
  updateCartUI();
  pageHistory = ['catalog', 'success'];
  showPage('success');
}

function resetAndGoHome() {
  pageHistory = ['catalog'];
  document.getElementById('searchInput').value = '';
  document.getElementById('aiInterpreted').classList.remove('visible');
  document.getElementById('manualBanner').classList.remove('visible');
  document.getElementById('requestSent').classList.remove('visible');
  document.getElementById('sectionLabel').textContent = '–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ';
  renderProducts('all');
  showPage('catalog');
}

function openProduct(id) {
  const e = { stopPropagation: () => {} };
  if (!cart[id]) addToCart(e, id);
  // Refresh current grid
  const q = document.getElementById('searchInput').value;
  if (!q) renderProducts(currentFilter);
}

// Init
renderProducts('all');
</script>
</body>
</html>